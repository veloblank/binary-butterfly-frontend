<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="./styles/style.css">
  <title>Binary Butterfly App</title>
</head>

<body>
  <div class="container">
    <nav class="nav" id="js-nav" data-view="daily-picks">
      <form action="">
        <input class="toggle-radio " type="radio" name="nav-toggle" value="daily-picks" id="nav-user-picks" checked />
        <label class="nav-toggle-label " for="nav-user-picks">
          Your Picks
        </label>
        <input class="toggle-radio" type="radio" name="nav-toggle" value="user-results" id="nav-user-results" />
        <label class="nav-toggle-label " for="nav-user-results">
          Your results
        </label>
        <input class="toggle-radio " type="radio" name="nav-toggle" value="leaderboards" id="nav-user-leaderboard" />
        <label class="nav-toggle-label" for="nav-user-leaderboard">
          Leaderboards
        </label>
      </form>
    </nav>
    <header class="week-description">
      <h2 class="week-number">Week 11</h2>
    </header>
    <h1>Daily Picks</h1>
    <div class="views view-is-active" id="daily-picks" style="visibility: visible;">
      <div id="picks">

      </div>
    </div>
    <div class="views" id="user-results" style="display:none;">User Results</div>
    <div class="views" id="leaderboards" style="display:none;">Leaderboards</div>
  </div>

  <div class="summary" style="display: flex">
    <div class="summary-group" id="remaining-picks">
      <h3 class="total-picks-made">
        <span id="daily-total-picks-made">

        </span> <span id="helper">of </span><span id="daily-total-picks">0</span> picks made</h3>
    </div>
    <div class="summary-group" id="user-score">
      <div id="user-prior-week-points">
        Your Week 10 points: <span>-55.0</span> points
      </div>
      <div id="user-total-points">
        Your Total Points: <span id="js-total-points">235</span> points
      </div>
    </div>
    <div class="summary-group" id="account-group">
      <button class="sign-in-button" id="signin-button">
        Sign in to play!
      </button>
    </div>
  </div>

  <div class="sign-in-modal" id="signin-modal">
    <div class="modal-content">
      <span class="modal-close-btn" id="modal-close-btn">&times;</span>
      <div class="google-signin" style="text-align: center">
        <img src="./images/google-icon.svg" alt="">
        <p><a href="#">Sign in with Google</a></p>
        <div class="form">
          <form onsubmit="handleCreateAccount(this)" id="create-account-form">
            <label for="email">Email</label><br>
            <input type="email" name="email" autofocus=true><br>

            <label for="username">Username</label><br>
            <input type="text" name="username"><br>

            <div class="errors-container">
              <!--The server encountered the following errors:-->
              <div class="error-field ">
                <ul id="account-errors"></ul>
              </div>
              <input id="create-account-btn" type="submit" value="Create Account">
            </div>

          </form>
        </div>
      </div>
    </div>
  </div>

  <script src="../src/index.js" type="module"></script>
  <script>
    function handleCreateAccount(form) {
      let formData = {
        email: form.elements[0].value,
        username: form.elements[1].value
      }

      let configObj = {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Accept": "application/json"
        },
        body: JSON.stringify(formData)
      };

      fetch('http://localhost:3050/api/v1/users', configObj)
        .then(response => response.json())
        .then(json => {
          if (json.message.status !== 201) {
            let parent = document.getElementById('account-errors')
            json.message.forEach(error => parent.innerHTML += (`<li>${error}</li>`))
          }
        })
        .catch(error => {
          console.log(error)
        });
    }
  </script>
</body>

</html>